#include <stdio.h>
#include <windows.h>
#include <conio.h>
#include <math.h>
#include <time.h>
void gotoxy(int x, int y){
	COORD Pos = {x,y};
	SetConsoleCursorPosition(GetStdHandle(STD_OUTPUT_HANDLE),Pos);
}
int main(){
	system("mode con cols=50 lines=25 | title=GAME");
	int j=0,my=23,px=24,py=23,lv2=0,lv3=0;
	int obx[1000]={6,24,},oby[1000]={23,20,},tech[3]={2,1,1};
	int lv=3,res=0,blx[1000]={24,22,18,16,18,16,18,20,22,14},bly[1000]={21,21,19,19,17,14,13,13,13,14},techb[3]={10,12,10},cn=0,cy=0,d=0,tg=0;
	int fx[10]={24,22},fy[10]={17,17},techf[3]={2,2,3};
	int itx[1000]={12,14},ity[1000]={20,18},techi[3]={0,0,2},eat=0;
	int bl1x[12]={24,26,26,26,26,28,30,32,24,22,28,26},bl1y[12]={21,21,20,19,18,18,18,16,18,18,14,14},ob1x[1]={28},ob1y[1]={17},f1x[2]={24,22},f1y[2]={11,11}; //2단계 레벨 데이터 
	int bl2x[10]={2,4,6,20,22,24,8,6,4,2},bl2y[10]={21,21,21,19,19,19,16,16,16,14},ob2x[1]={4},ob2y[1]={15},f2x[3]={4,6,8},f2y[3]={11,11,11}; //3단계 레벨 데이터  
	char c,vol;
	float t=0;
	while(1){
		system("cls");
		gotoxy(px,py);
		printf("■");
		gotoxy(20,0);
		printf("level %d",lv); 
		gotoxy(0,0);
		printf("%.1f sec",t);
		if(lv==2){
			if(lv2!=1){
				for(int i=0;i<techb[lv-1];i++){
					blx[i]=bl1x[i];
					bly[i]=bl1y[i];
				}
				for(int i=0;i<tech[lv-1];i++){
					obx[i]=ob1x[i];
					oby[i]=ob1y[i];
				}
				for(int i=0;i<techf[lv-1];i++){
					fx[i]=f1x[i];
					fy[i]=f1y[i];
				}
				lv2=1;
			}
		}
		else if(lv==3){
			if(lv3!=1){
				for(int i=0;i<techb[lv-1];i++){
					blx[i]=bl2x[i];
					bly[i]=bl2y[i];
				}
				for(int i=0;i<tech[lv-1];i++){
					obx[i]=ob2x[i];
					oby[i]=ob2y[i];
				}
				for(int i=0;i<techf[lv-1];i++){
					fx[i]=f2x[i];
					fy[i]=f2y[i];
				}
				lv3=1;
			}
		}
		if(j==1){
			j=0;
			for(int t=0;t<=4;t++){   
				py=my-round(-1*(t-2)*(t-2)+4);
				if(kbhit()){
					c=getch();
					switch(c){
						case 'd': if(px!=48) px+=2; break;
						case 'a': if(px!=0) px-=2; break;
						default: break;
					}
				}
				for(int i=0;i<tech[lv-1];i++){
					if(px==obx[i]){
						if(py==oby[i]){
							Sleep(50);
							res=2;
							break;
						}
					}
				}
				for(int i=0;i<techb[lv-1];i++){
					if(py<=bly[i]){
						if(px==blx[i]){
							if(bly[i]<my){
								cn=1;
								cy=py;
								break;
							}
						}
					}
				}
				for(int i=0;i<techf[lv-1];i++){
					if(py<=fy[i]){
						if(px==fx[i]){
							if(fy[i]<my){
								cn=1;
								cy=py;
								break;
							}
						}
					}
				}
				for(int i=0;i<techb[lv-1];i++){
					gotoxy(blx[i],bly[i]);
					printf("□");
				}
				for(int i=0;i<tech[lv-1];i++){
					gotoxy(obx[i],oby[i]);
					printf("△");
				}
				if(cn==1){
					if(t<=2){
						t=4-t;
						cn=0;
					}
					else break;
				}
				if(res==2) break;
				system("cls");
				gotoxy(px,py);
				printf("■");
				Sleep(100);
			}
		}  
		my=py;
		if(kbhit()){  
			c=getch();
			switch(c){
				case ' ': j=1; break;
				case 'd': if(px!=48) px+=2; break;
				case 'a': if(px!=0) px-=2; break;
				default: break;
			}
		} 
		for(int i=0;i<tech[lv-1];i++){  
			gotoxy(obx[i],oby[i]);
			printf("△");
		} 
		for(int i=0;i<tech[lv-1];i++){   
			if(px==obx[i]){
				if(py==oby[i]){
					Sleep(50);
					res=2;
					break;
				}
			}
		} 
		for(int i=0;i<techb[lv-1];i++){
			gotoxy(blx[i],bly[i]);
			printf("□");
		}
		for(int i=0;i<techf[lv-1];i++){  
			gotoxy(fx[i],fy[i]);
			printf("▣");
		} 
		for(int i=0;i<techb[lv-1];i++){
			if(px==fx[i] && py+1==fy[i]){
				lv++;
				px=24;
				py=23;
				break;
			}
		}
		for(int i=0;i<techi[lv-1];i++){
			gotoxy(itx[i],ity[i]);
			printf("◎");
		} 
		for(int i=0;i<techb[lv-1];i++){
			if((px==blx[i] && py+1==bly[i])!=1 && my<23){
				d+=1;
			}
		}
		if(d==techb[lv-1]){
			while(py<23){
				for(int i=0;i<techb[lv-1];i++){
					if((px==blx[i] && py+1==bly[i])==1){
						tg=1;
						break;
					}
				}
				if(tg==1) break;
				if(kbhit()){
					c=getch();
					switch(c){
						case 'a': px-=2; break;
						case 'd': px+=2; break;
						default: break;
					}
				}
				py++;
				system("cls");
				gotoxy(px,py);
				printf("■");
				Sleep(100);
			}
		}
		tg=0;
		d=0;
		t+=0.1;
		if(res==2) break;
		Sleep(100);
	}
	system("cls");
	gotoxy(19,12);
	if(res==2) printf("Game Over");
	else printf("Game Completed!");
	gotoxy(0,0);
	scanf("%c",&vol);
}
